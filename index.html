<!DOCTYPE html>
<html lang="en" data-theme="midnight">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SoLoVision Command Center</title>
        <link rel="icon" type="image/png" href="/solobot-avatar.png">
        <script>
            // Apply theme immediately before paint to prevent flash
            (function () {
                var m = { dark: "midnight", light: "snow" };
                var t = localStorage.getItem("solobot-theme") ||
                    localStorage.getItem("theme") || "midnight";
                if (m[t]) t = m[t];
                document.documentElement.setAttribute(
                    "data-theme",
                    t,
                );
            })();
        </script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        >
        <style>
        <link rel="stylesheet" href="css/themes.css?v=4.0.0">
        <link rel="stylesheet" href="css/layout.css?v=4.0.0">
        <link rel="stylesheet" href="css/components.css?v=4.0.0">
        <link rel="stylesheet" href="css/modals.css?v=4.0.0">
        <link rel="stylesheet" href="css/chat.css?v=4.0.0">
        <link rel="stylesheet" href="css/pages.css?v=4.0.0">
    </head>
    <body>
        <!-- App Layout with Sidebar -->
        <div class="app-layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <button
                    class="sidebar-toggle"
                    onclick="toggleSidebarPin()"
                    title="Pin sidebar"
                >
                    <span id="sidebar-pin-icon">üîì</span>
                </button>
                <div class="sidebar-logo">
                    <img
                        src="/solobot-avatar.png"
                        alt="SoLoBot"
                        class="sidebar-logo-img"
                    >
                </div>

                <nav class="sidebar-nav">
                    <a
                        class="sidebar-item active"
                        onclick="showPage('dashboard')"
                        data-page="dashboard"
                    >
                        <span class="sidebar-item-icon">üè†</span>
                        <span class="sidebar-item-text">Dashboard</span>
                    </a>
                    <a
                        class="sidebar-item"
                        onclick="showPage('memory')"
                        data-page="memory"
                    >
                        <span class="sidebar-item-icon">üß†</span>
                        <span class="sidebar-item-text">Memory</span>
                    </a>
                    <a
                        class="sidebar-item"
                        onclick="showPage('chat')"
                        data-page="chat"
                    >
                        <span class="sidebar-item-icon">üí¨</span>
                        <span class="sidebar-item-text">Chat</span>
                    </a>
                    <a
                        class="sidebar-item"
                        onclick="showPage('system')"
                        data-page="system"
                    >
                        <span class="sidebar-item-icon">üìü</span>
                        <span class="sidebar-item-text">System</span>
                    </a>
                    <a
                        class="sidebar-item"
                        onclick="showPage('products')"
                        data-page="products"
                    >
                        <span class="sidebar-item-icon">üì¶</span>
                        <span class="sidebar-item-text">Products</span>
                    </a>

                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Agents</div>
                        <div class="sidebar-agent" data-agent="main">
                            <img
                                class="agent-avatar"
                                src="/avatars/solobot.png"
                                alt="Main"
                            >
                            <span class="sidebar-item-text"
                            >SoLoBot (Main)</span>
                        </div>
                        <div class="sidebar-agent" data-agent="exec">
                            <img
                                class="agent-avatar"
                                src="/avatars/exec.png"
                                alt="EXEC"
                            >
                            <span class="sidebar-item-text">SoLoBot-EXEC</span>
                        </div>
                        <div class="sidebar-agent" data-agent="coo">
                            <img
                                class="agent-avatar"
                                src="/avatars/coo.png"
                                alt="COO"
                            >
                            <span class="sidebar-item-text">SoLoBot-COO</span>
                        </div>
                        <div class="sidebar-agent" data-agent="cfo">
                            <img
                                class="agent-avatar"
                                src="/avatars/cfo.png"
                                alt="CFO"
                            >
                            <span class="sidebar-item-text">SoLoBot-CFO</span>
                        </div>
                        <div class="sidebar-agent" data-agent="cmp">
                            <img
                                class="agent-avatar"
                                src="/avatars/cmp.png"
                                alt="CMP"
                            >
                            <span class="sidebar-item-text">SoLoBot-CMP</span>
                        </div>
                        <div class="sidebar-agent" data-agent="dev">
                            <img
                                class="agent-avatar"
                                src="/avatars/dev.png"
                                alt="DEV"
                            >
                            <span class="sidebar-item-text">SoLoBot-DEV</span>
                        </div>
                        <div class="sidebar-agent" data-agent="family">
                            <img
                                class="agent-avatar"
                                src="/avatars/family.png"
                                alt="Family"
                            >
                            <span class="sidebar-item-text"
                            >SoLoBot-Family</span>
                        </div>
                        <div class="sidebar-agent" data-agent="tax">
                            <img
                                class="agent-avatar"
                                src="/avatars/tax.svg"
                                alt="TAX"
                            >
                            <span class="sidebar-item-text">SoLoBot-Tax</span>
                        </div>
                        <div class="sidebar-agent" data-agent="sec">
                            <img
                                class="agent-avatar"
                                src="/avatars/sec.svg"
                                alt="SEC"
                            >
                            <span class="sidebar-item-text">SoLoBot-SEC</span>
                        </div>
                        <div class="sidebar-agent" data-agent="smm">
                            <img
                                class="agent-avatar"
                                src="/avatars/smm.svg"
                                alt="SMM"
                            >
                            <span class="sidebar-item-text">SoLoBot-SMM</span>
                        </div>
                    </div>
                </nav>

                <div class="sidebar-footer">
                    <a class="sidebar-item" onclick="openSettingsModal()">
                        <span class="sidebar-item-icon">üîß</span>
                        <span class="sidebar-item-text">Settings</span>
                    </a>
                </div>
            </aside>

            <!-- Main App Content -->
            <div class="app-content">
                <!-- Header -->
                <header class="header">
                    <div class="container header-inner">
                        <div class="logo">
                            <span style="font-size: 1.25rem; font-weight: 600"
                            >SoLoBot</span>
                        </div>

                        <div class="header-status">
                            <!-- Focus Timer -->
                            <div
                                id="focus-timer"
                                class="focus-timer"
                                title="Focus Timer - Click to start a 25-min focus session"
                            >
                                <button
                                    class="focus-timer-btn"
                                    onclick="toggleFocusTimer()"
                                    title="Start/Pause"
                                >
                                    <svg
                                        id="focus-play-icon"
                                        style="width: 16px; height: 16px"
                                        fill="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path d="M8 5v14l11-7z" />
                                    </svg>
                                    <svg
                                        id="focus-pause-icon"
                                        style="width: 16px; height: 16px; display: none"
                                        fill="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"
                                        />
                                    </svg>
                                </button>
                                <span
                                    class="focus-timer-display"
                                    id="focus-timer-display"
                                >25:00</span>
                                <button
                                    class="focus-timer-btn"
                                    onclick="resetFocusTimer()"
                                    title="Reset"
                                >
                                    <svg
                                        style="width: 14px; height: 14px"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                                        />
                                    </svg>
                                </button>
                                <span
                                    class="focus-timer-sessions"
                                    id="focus-sessions"
                                >0 üéØ</span>
                            </div>

                            <!-- Notification Bell -->
                            <div id="notification-bell" class="notification-bell" onclick="toggleNotificationPanel()" title="Notifications">
                                üîî
                                <span id="notification-bell-badge" class="notification-bell-badge" style="display:none;">0</span>
                            </div>

                            <div class="status-chip">
                                <div
                                    id="status-indicator"
                                    class="status-dot success pulse"
                                >
                                </div>
                                <span id="status-text">IDLE</span>
                            </div>

                            <div class="header-meta">
                                <div>
                                    Provider:
                                    <select
                                        id="provider-select"
                                        class="header-select"
                                        onchange="updateProviderDisplay()"
                                    >
                                        <!-- Populated dynamically from /api/models/list -->
                                    </select>
                                </div>
                                <div
                                    style="display: flex; align-items: center; gap: 6px"
                                >
                                    Model:
                                    <select
                                        id="model-select"
                                        class="header-select"
                                        onchange="changeSessionModel()"
                                        title="Change model for this session"
                                    >
                                        <!-- Populated dynamically -->
                                    </select>
                                    <button
                                        onclick="changeSessionModel()"
                                        class="btn btn-primary"
                                        style="padding: 2px 8px; font-size: 11px; min-height: 24px"
                                        title="Apply selected model to session"
                                    >
                                        Apply
                                    </button>
                                </div>
                            </div>

                            <button
                                class="theme-toggle"
                                onclick="openSettingsModal()"
                                title="Settings"
                            >
                                <svg
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    style="width: 20px; height: 20px"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                                    />
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                    />
                                </svg>
                            </button>

                            <button
                                class="theme-toggle"
                                onclick="openSettingsModal(); scrollToThemePicker();"
                                title="Change theme"
                            >
                                <svg
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    style="width: 18px; height: 18px"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                                    />
                                </svg>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Sub-agent Banner -->
                <div
                    id="subagent-banner"
                    class="hidden"
                    style="background: var(--warning-muted); border-bottom: 1px solid var(--border-default); padding: var(--space-2) 0"
                >
                    <div
                        class="container flex items-center gap-2"
                        style="font-size: 13px"
                    >
                        <svg
                            class="animate-spin"
                            style="width: 16px; height: 16px; color: var(--warning)"
                            fill="none"
                            viewBox="0 0 24 24"
                        >
                            <circle
                                style="opacity: 0.25"
                                cx="12"
                                cy="12"
                                r="10"
                                stroke="currentColor"
                                stroke-width="4"
                            >
                            </circle>
                            <path
                                style="opacity: 0.75"
                                fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                            >
                            </path>
                        </svg>
                        <span style="color: var(--warning); font-weight: 500"
                        >Sub-agent active:</span>
                        <span id="subagent-task">Researching...</span>
                    </div>
                </div>

                <!-- Main Content -->
                <main class="main">
                    <!-- =================== DASHBOARD PAGE (BENTO GRID) =================== -->
                    <div id="page-dashboard" class="page active">
                        <div class="bento-grid">
                            <!-- Task Board Widget -->
                            <div class="bento-widget bento-task-board">
                                <div class="bento-widget-header">
                                    <div class="bento-widget-title">
                                        <svg
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                                            >
                                            </path>
                                        </svg>
                                        Task Board
                                    </div>
                                    <div class="bento-widget-actions">
                                        <button
                                            onclick="openArchiveModal()"
                                            class="btn btn-ghost"
                                            style="padding: 4px 8px; font-size: 12px"
                                        >
                                            <span>üì¶</span>
                                            <span
                                                id="archive-badge"
                                                class="badge badge-error hidden"
                                                style="margin-left: 4px"
                                            >0</span>
                                        </button>
                                        <button
                                            onclick="syncFromVPS()"
                                            class="btn btn-ghost"
                                            title="Pull latest state from VPS"
                                            style="padding: 4px 8px; font-size: 12px"
                                        >
                                            <span>üîÑ</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="bento-widget-content">
                                    <!-- Task Board Toolbar ‚Äî compact single row -->
                                    <div id="task-toolbar" style="display: flex; gap: 6px; align-items: center; padding-bottom: 8px; margin-bottom: 8px; border-bottom: 1px solid var(--border); overflow-x: auto;">
                                        <div style="position: relative; min-width: 120px; max-width: 160px; flex-shrink: 0;">
                                            <input type="text" id="task-search" placeholder="Search..."
                                                   oninput="applyTaskFilters()"
                                                   class="input" style="padding: 2px 6px 2px 22px; font-size: 11px; height: 26px; width: 100%; border-radius: 4px;">
                                            <span style="position: absolute; left: 6px; top: 50%; transform: translateY(-50%); font-size: 10px; opacity: 0.4;">üîç</span>
                                        </div>
                                        <select id="task-sort" onchange="applyTaskFilters()" class="input" style="padding: 2px 4px; font-size: 11px; height: 26px; border-radius: 4px; min-width: 0; max-width: 100px;">
                                            <option value="newest">Newest</option>
                                            <option value="oldest">Oldest</option>
                                            <option value="priority-high">P ‚Üë</option>
                                            <option value="priority-low">P ‚Üì</option>
                                            <option value="alpha-az">A‚ÜíZ</option>
                                            <option value="alpha-za">Z‚ÜíA</option>
                                        </select>
                                        <select id="task-filter-priority" onchange="applyTaskFilters()" class="input" style="padding: 2px 4px; font-size: 11px; height: 26px; border-radius: 4px; min-width: 0; max-width: 60px;">
                                            <option value="all">P*</option>
                                            <option value="0">üî¥</option>
                                            <option value="1">üü°</option>
                                            <option value="2">üü¢</option>
                                        </select>
                                        <select id="task-filter-agent" onchange="applyTaskFilters()" class="input" style="padding: 2px 4px; font-size: 11px; height: 26px; border-radius: 4px; min-width: 0; max-width: 90px;">
                                            <option value="all">Agent</option>
                                        </select>
                                        <div id="task-bulk-actions" style="display: none; gap: 3px; align-items: center; flex-shrink: 0;">
                                            <span id="task-selected-count" style="font-size: 10px; color: var(--text-muted);">0</span>
                                            <button onclick="bulkMoveTo('done')" class="btn btn-ghost" style="padding: 1px 4px; font-size: 10px; line-height: 1;" title="Done">‚úì</button>
                                            <button onclick="bulkMoveTo('archive')" class="btn btn-ghost" style="padding: 1px 4px; font-size: 10px; line-height: 1;" title="Archive">üì¶</button>
                                            <button onclick="bulkDelete()" class="btn btn-ghost" style="padding: 1px 4px; font-size: 10px; line-height: 1; color: var(--error);" title="Delete">üóë</button>
                                        </div>
                                        <div id="task-stats" style="font-size: 10px; color: var(--text-muted); margin-left: auto; white-space: nowrap; flex-shrink: 0;"></div>
                                    </div>
                                    
                                    <div class="grid-3">
                                        <!-- To-Do Column -->
                                        <div class="column">
                                            <div class="column-header">
                                                <h3 class="column-title">
                                                    <span
                                                        class="status-dot idle"
                                                    ></span>
                                                    To-Do
                                                    <span
                                                        id="todo-count"
                                                        class="badge badge-default"
                                                    >0</span>
                                                </h3>
                                                <button
                                                    onclick="openAddTask('todo')"
                                                    class="btn-icon"
                                                    title="Add task"
                                                >
                                                    <svg
                                                        style="width: 16px; height: 16px"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        viewBox="0 0 24 24"
                                                    >
                                                        <path
                                                            stroke-linecap="round"
                                                            stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M12 4v16m8-8H4"
                                                        >
                                                        </path>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div
                                                id="todo-tasks"
                                                class="drop-zone space-y-2"
                                                ondragover="handleDragOver(event)"
                                                ondragenter="handleDragEnter(event, 'todo')"
                                                ondragleave="handleDragLeave(event, 'todo')"
                                                ondrop="handleDrop(event, 'todo')"
                                            >
                                            </div>
                                        </div>

                                        <!-- In Progress Column -->
                                        <div class="column">
                                            <div class="column-header">
                                                <h3 class="column-title">
                                                    <span
                                                        class="status-dot warning"
                                                    ></span>
                                                    In Progress
                                                    <span
                                                        id="progress-count"
                                                        class="badge badge-default"
                                                    >0</span>
                                                </h3>
                                            </div>
                                            <div
                                                id="progress-tasks"
                                                class="drop-zone space-y-2"
                                                ondragover="handleDragOver(event)"
                                                ondragenter="handleDragEnter(event, 'progress')"
                                                ondragleave="handleDragLeave(event, 'progress')"
                                                ondrop="handleDrop(event, 'progress')"
                                            >
                                            </div>
                                        </div>

                                        <!-- Done Column -->
                                        <div class="column">
                                            <div class="column-header">
                                                <h3 class="column-title">
                                                    <span
                                                        class="status-dot success"
                                                    ></span>
                                                    Done
                                                    <span
                                                        id="done-count"
                                                        class="badge badge-default"
                                                    >0</span>
                                                </h3>
                                                <button
                                                    onclick="clearDone()"
                                                    class="btn-icon"
                                                    title="Clear done"
                                                    style="font-size: 11px; color: var(--text-muted)"
                                                >
                                                    Clear
                                                </button>
                                            </div>
                                            <div
                                                id="done-tasks"
                                                class="drop-zone space-y-2"
                                                ondragover="handleDragOver(event)"
                                                ondragenter="handleDragEnter(event, 'done')"
                                                ondragleave="handleDragLeave(event, 'done')"
                                                ondrop="handleDrop(event, 'done')"
                                            >
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Stats Widget -->
                            <div class="bento-widget bento-quick-stats">
                                <div
                                    class="bento-widget-content"
                                    style="padding: var(--space-3)"
                                >
                                    <div class="quick-stats-header">
                                        <div
                                            class="bento-widget-title"
                                            style="margin-bottom: 0"
                                        >
                                            <svg
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                                                />
                                            </svg>
                                            Quick Stats
                                        </div>
                                        <span
                                            id="stats-last-updated"
                                            style="font-size: 10px; color: var(--text-muted)"
                                        >Updated just now</span>
                                    </div>
                                    <div class="quick-stats-grid">
                                        <div class="stat-item">
                                            <div
                                                class="stat-value brand"
                                                id="stat-tasks-done"
                                            >
                                                0
                                            </div>
                                            <div class="stat-label">
                                                Tasks Done
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div
                                                class="stat-value"
                                                id="stat-focus-sessions"
                                            >
                                                0
                                            </div>
                                            <div class="stat-label">Focus</div>
                                        </div>
                                        <div class="stat-item">
                                            <div
                                                class="stat-value"
                                                id="stat-messages"
                                            >
                                                0
                                            </div>
                                            <div class="stat-label">
                                                Messages
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div
                                                class="stat-value"
                                                id="stat-streak"
                                            >
                                                0
                                            </div>
                                            <div class="stat-label">
                                                Streak üî•
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div
                                                class="stat-value"
                                                id="stat-uptime"
                                            >
                                                --
                                            </div>
                                            <div class="stat-label">
                                                Session
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Terminal Widget -->
                            <div class="bento-widget bento-terminal">
                                <div
                                    class="terminal"
                                    id="console-section"
                                    style="height: 100%; display: flex; flex-direction: column; border: none; border-radius: 0"
                                >
                                    <div class="terminal-header">
                                        <div class="flex items-center gap-3">
                                            <div class="terminal-dots">
                                                <span class="red"></span>
                                                <span class="yellow"></span>
                                                <span class="green"></span>
                                            </div>
                                            <span class="terminal-title"
                                            >Terminal</span>
                                            <span
                                                id="console-status-badge"
                                                class="badge badge-success"
                                            >IDLE</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button
                                                onclick="clearConsole()"
                                                class="btn-icon"
                                                style="font-size: 11px"
                                            >
                                                Clear
                                            </button>
                                        </div>
                                    </div>
                                    <div
                                        id="console-output"
                                        class="terminal-output"
                                        style="flex: 1; overflow-y: auto"
                                    >
                                        <div class="cmd">$ solobot --init</div>
                                        <div class="info">
                                            Ready for commands...
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Activity Log Widget -->
                            <div class="bento-widget bento-activity">
                                <div class="bento-widget-header">
                                    <div class="bento-widget-title">
                                        <svg
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                            >
                                            </path>
                                        </svg>
                                        Activity
                                    </div>
                                </div>
                                <div class="bento-widget-content">
                                    <div
                                        id="activity-log"
                                        class="activity-list"
                                    >
                                    </div>
                                </div>
                            </div>

                            <!-- Notes Widget -->
                            <div class="bento-widget bento-notes">
                                <div class="bento-widget-header">
                                    <div class="bento-widget-title">
                                        <svg
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                                            >
                                            </path>
                                        </svg>
                                        Notes
                                    </div>
                                </div>
                                <div class="bento-widget-content">
                                    <div
                                        class="notes-input"
                                        style="margin-bottom: var(--space-3)"
                                    >
                                        <input
                                            type="text"
                                            id="note-input"
                                            class="input flex-1"
                                            placeholder="Leave a note for SoLoBot..."
                                            style="font-size: 13px"
                                        >
                                        <button
                                            onclick="addNote()"
                                            class="btn btn-primary"
                                            style="padding: 6px 12px; font-size: 13px"
                                        >
                                            Add
                                        </button>
                                    </div>
                                    <div id="notes-list" class="notes-list">
                                    </div>
                                </div>
                            </div>

                            <!-- Chat Widget -->
                            <div class="bento-widget bento-chat">
                                <div class="bento-widget-header">
                                    <div class="bento-widget-title">
                                        <svg
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                                            >
                                            </path>
                                        </svg>
                                        Chat
                                        <div
                                            class="flex items-center gap-2"
                                            style="margin-left: auto"
                                        >
                                            <span
                                                id="current-session-name"
                                                style="font-size: 11px; color: var(--accent-color); font-weight: 600; background: var(--surface-2); padding: 2px 6px; border-radius: 4px"
                                            >main</span>
                                        </div>
                                    </div>
                                    <div class="bento-widget-actions">
                                        <span
                                            id="gateway-status-dot"
                                            class="status-dot idle"
                                        ></span>
                                        <span
                                            id="gateway-status"
                                            style="font-size: 11px; color: var(--text-muted)"
                                        >Disconnected</span>
                                    </div>
                                </div>
                                <div
                                    style="flex: 1; display: flex; flex-direction: column; min-height: 0; overflow: hidden"
                                >
                                    <div
                                        id="chat-messages"
                                        class="chat-messages"
                                        style="flex: 1; overflow-y: auto; padding: var(--space-3)"
                                    >
                                        <div
                                            style="color: var(--text-muted); font-size: 12px; text-align: center; padding: var(--space-8) 0"
                                        >
                                            üîå Connect to Gateway in Settings to
                                            start chatting
                                        </div>
                                    </div>

                                    <!-- Image Preview (supports multiple) -->
                                    <div
                                        id="image-preview-container"
                                        class="image-preview-container"
                                    >
                                        <!-- Thumbnails rendered dynamically -->
                                    </div>

                                    <div
                                        class="chat-input-area"
                                        style="border-top: 1px solid var(--border-default); padding: var(--space-2)"
                                    >
                                        <label
                                            class="btn-icon"
                                            style="cursor: pointer"
                                        >
                                            <input
                                                type="file"
                                                id="image-upload"
                                                accept="image/*"
                                                multiple
                                                class="hidden"
                                                onchange="handleImageSelect(event)"
                                            >
                                            <svg
                                                style="width: 16px; height: 16px"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                                                >
                                                </path>
                                            </svg>
                                        </label>
                                        <div class="voice-controls">
                                            <button
                                                id="voice-input-btn"
                                                class="voice-btn"
                                                onclick="toggleVoiceInput()"
                                                title="Voice input"
                                            >
                                                <svg
                                                    id="voice-icon-mic"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                    style="width: 16px; height: 16px"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
                                                    >
                                                    </path>
                                                </svg>
                                                <svg
                                                    id="voice-icon-stop"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                    style="display: none; width: 16px; height: 16px"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                                    >
                                                    </path>
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"
                                                    >
                                                    </path>
                                                </svg>
                                            </button>
                                            <button
                                                class="voice-auto-send-toggle"
                                                onclick="toggleVoiceAutoSend()"
                                                title="Auto-send"
                                            >
                                                ‚ö°
                                            </button>
                                        </div>
                                        <input
                                            type="text"
                                            id="chat-input"
                                            class="input flex-1"
                                            placeholder="Message..."
                                            name="dashboard_chat_field_"
                                            onkeypress="if(event.key==='Enter')sendChatMessage()"
                                            onpaste="handlePaste(event)"
                                            autocomplete="off"
                                            autocorrect="off"
                                            autocapitalize="off"
                                            spellcheck="false"
                                            data-lpignore="true"
                                            data-1p-ignore="true"
                                            data-form-type="other"
                                            style="font-size: 13px; padding: 6px 8px"
                                        >
                                        <button
                                            onclick="sendChatMessage()"
                                            class="btn btn-primary"
                                            style="padding: 6px 12px; font-size: 13px"
                                        >
                                            Send
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END DASHBOARD PAGE -->

                    <!-- =================== MEMORY PAGE =================== -->
                    <div id="page-memory" class="page">
                        <div class="memory-page">
                            <div class="page-header">
                                <h1 class="page-title">
                                    üß† Memory Files
                                </h1>
                                <p class="page-subtitle">
                                    These are SoLoBot's live memory files. Edit
                                    them here and they'll sync back to the
                                    workspace.
                                </p>
                            </div>

                            <div class="memory-search-bar">
                                <input
                                    type="text"
                                    id="memory-search"
                                    class="input"
                                    placeholder="Search memory files..."
                                    oninput="renderMemoryFiles(this.value)"
                                >
                                <button
                                    class="btn btn-secondary"
                                    onclick="syncMemoryFilesNow()"
                                >
                                    üîÑ Sync Now
                                </button>
                                <div id="sync-status" class="sync-status">
                                    <span class="status-dot success"></span>
                                    Last synced: <span id="last-memory-sync"
                                    >--</span>
                                </div>
                            </div>

                            <div id="memory-files-grid" class="docs-grid">
                                <!-- Memory files will be rendered here -->
                            </div>
                        </div>
                    </div>
                    <!-- END MEMORY PAGE -->

                    <!-- =================== CHAT PAGE =================== -->
                    <div id="page-chat" class="page">
                        <div class="chat-page-wrapper">
                            <!-- Chat Actions Bar -->
                            <div class="chat-page-header">
                                <div class="chat-page-title">
                                    <span
                                        id="chat-page-agent-name"
                                        style="font-size: 14px; font-weight: 600; color: var(--text-primary)"
                                    ></span>
                                    <span
                                        id="chat-page-status-dot"
                                        class="status-dot idle"
                                    ></span>
                                    <span id="chat-page-status-text"
                                    >Disconnected</span>
                                </div>
                                <div class="chat-page-actions">
                                    <div
                                        class="session-selector-wrapper"
                                        style="position: relative; display: inline-flex; align-items: center; margin-right: 8px"
                                    >
                                        <span
                                            id="chat-page-session-name"
                                            style="font-size: 13px; color: var(--accent-color); font-weight: 600; background: var(--surface-elevated); padding: 4px 10px; border-radius: 6px; border: 1px solid var(--border-color)"
                                        >main</span>
                                        <button
                                            onclick="toggleChatPageSessionMenu()"
                                            class="btn btn-icon"
                                            style="padding: 4px; margin-left: 2px"
                                            title="Switch session"
                                        >
                                            <svg
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                                style="width: 16px; height: 16px"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M19 9l-7 7-7-7"
                                                >
                                                </path>
                                            </svg>
                                        </button>
                                        <div
                                            id="chat-page-session-menu"
                                            class="hidden session-dropdown-menu"
                                            style="max-height: 300px; overflow-y: auto"
                                        >
                                            <!-- Sessions populated dynamically -->
                                        </div>
                                    </div>
                                    <button
                                        onclick="clearChatHistory()"
                                        class="btn btn-ghost"
                                        title="Clear chat"
                                    >
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>

                            <!-- Messages Area -->
                            <div
                                id="chat-page-messages"
                                class="chat-page-messages"
                            >
                                <!-- Messages rendered by JS -->
                            </div>

                            <!-- Floating scroll to bottom button -->
                            <button
                                id="scroll-to-bottom-btn"
                                class="scroll-to-bottom-btn hidden"
                                onclick="scrollChatToBottom()"
                                title="Scroll to latest"
                            >
                                ‚Üì
                            </button>

                            <!-- New message indicator (shown when scrolled up) -->
                            <div
                                id="chat-page-new-indicator"
                                class="chat-page-new-message-indicator hidden"
                                onclick="scrollChatToBottom()"
                            >
                                ‚Üì New messages
                            </div>

                            <!-- Fixed Input Area -->
                            <div class="chat-page-input-area">
                                <div class="chat-page-input-container">
                                    <!-- Image Preview (supports multiple) -->
                                    <div
                                        id="chat-page-image-preview"
                                        class="hidden image-preview-container"
                                    >
                                        <!-- Thumbnails rendered dynamically -->
                                    </div>

                                    <div class="chat-page-input-row">
                                        <input
                                            type="file"
                                            id="chat-page-image-upload"
                                            accept="image/*"
                                            multiple
                                            class="hidden"
                                            onchange="handleChatPageImageSelect(event)"
                                        >
                                        <button
                                            onclick="document.getElementById('chat-page-image-upload').click()"
                                            class="btn btn-ghost"
                                            title="Attach image"
                                        >
                                            üìé
                                        </button>
                                        <div class="voice-controls">
                                            <button
                                                id="voice-input-btn-chatpage"
                                                class="voice-btn"
                                                onclick="toggleVoiceInputChatPage()"
                                                title="Voice input (click to speak, or hold spacebar)"
                                            >
                                                <svg
                                                    id="voice-icon-mic-chatpage"
                                                    style="width: 20px; height: 20px"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"
                                                    >
                                                    </path>
                                                </svg>
                                                <svg
                                                    id="voice-icon-stop-chatpage"
                                                    style="width: 20px; height: 20px; display: none"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                                    >
                                                    </path>
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"
                                                    >
                                                    </path>
                                                </svg>
                                            </button>
                                            <button
                                                class="voice-auto-send-toggle"
                                                onclick="toggleVoiceAutoSend()"
                                                title="Auto-send OFF (click to enable)"
                                            >
                                                ‚ö°
                                            </button>
                                        </div>
                                        <!-- Hidden decoy fields to trick password managers -->
                                        <input
                                            type="text"
                                            name="fake_username_field"
                                            style="display: none"
                                            tabindex="-1"
                                            aria-hidden="true"
                                        >
                                        <input
                                            type="password"
                                            name="fake_password_field"
                                            style="display: none"
                                            tabindex="-1"
                                            aria-hidden="true"
                                        >
                                        <textarea
                                            id="chat-page-input"
                                            name="chat_message_input_field_"
                                            placeholder="Message SoLoBot..."
                                            onpaste="handleChatPagePaste(event)"
                                            autocomplete="off"
                                            autocorrect="off"
                                            autocapitalize="off"
                                            spellcheck="false"
                                            data-lpignore="true"
                                            data-form-type="other"
                                            data-1p-ignore="true"
                                            rows="1"
                                        ></textarea>
                                        <button
                                            onclick="sendChatPageMessage()"
                                            class="btn btn-primary"
                                        >
                                            Send
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END CHAT PAGE -->

                    <!-- =================== SYSTEM PAGE =================== -->
                    <div id="page-system" class="page">
                        <div class="chat-page-wrapper">
                            <!-- Header -->
                            <div class="chat-page-header">
                                <div class="chat-page-title">
                                    <h1>üìü System Messages</h1>
                                </div>
                                <div class="chat-page-actions">
                                    <button
                                        onclick="clearSystemHistory()"
                                        class="btn btn-ghost"
                                        title="Clear system messages"
                                    >
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>

                            <!-- Messages Area -->
                            <div
                                id="system-page-messages"
                                class="chat-page-messages"
                            >
                                <!-- System messages rendered by JS -->
                            </div>
                        </div>
                    </div>
                    <!-- END SYSTEM PAGE -->

                    <!-- =================== PRODUCTS PAGE =================== -->
                    <div id="page-products" class="page">
                        <div class="container" style="padding: var(--space-6)">
                            <div
                                class="page-header"
                                style="margin-bottom: var(--space-6)"
                            >
                                <h1
                                    class="page-title"
                                    style="font-size: 24px; font-weight: 700"
                                >
                                    üì¶ SoLoVision Products
                                </h1>
                                <p
                                    class="page-subtitle"
                                    style="color: var(--text-secondary); margin-top: var(--space-2)"
                                >
                                    Manage and monitor all SoLoVision products
                                </p>
                            </div>
                            <div id="products-page-grid" class="grid-3">
                                <!-- Products will be rendered here -->
                                <p style="color: var(--text-muted)">
                                    Expanded product management coming soon.
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- END PRODUCTS PAGE -->
                </main>

                <!-- Footer -->
                <footer class="footer">
                    <div class="container footer-inner">
                        <span>SoLoVision LLC ¬© 2026</span>
                        <div class="footer-status">
                            <div class="live-indicator">
                                <span class="status-dot success pulse"></span>
                                <span>LIVE</span>
                            </div>
                            <span>Last sync: <span id="last-sync"
                                >--:--</span></span>
                        </div>
                    </div>
                </footer>

                <!-- Bulk Action Bar -->
                <div id="bulk-action-bar" class="bulk-action-bar">
                    <span
                        id="bulk-count"
                        style="font-size: 13px; font-weight: 500"
                    >0 selected</span>
                    <button onclick="bulkMoveTo('todo')" class="btn btn-ghost">
                        ‚Üí To-Do
                    </button>
                    <button
                        onclick="bulkMoveTo('progress')"
                        class="btn btn-ghost"
                    >
                        ‚Üí In Progress
                    </button>
                    <button onclick="bulkMoveTo('done')" class="btn btn-ghost">
                        ‚Üí Done
                    </button>
                    <button
                        onclick="bulkMoveTo('archive')"
                        class="btn btn-ghost"
                    >
                        üì¶ Archive
                    </button>
                    <button onclick="clearSelection()" class="btn-icon">
                        ‚úï
                    </button>
                </div>

                <!-- Add Task Modal -->
                <div id="add-task-modal" class="modal-overlay">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">Add New Task</h3>
                            <button
                                onclick="closeAddTask()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>
                        <input
                            type="text"
                            id="new-task-title"
                            class="input"
                            placeholder="Task title..."
                            style="margin-bottom: var(--space-4)"
                        >
                        <div
                            class="flex gap-2"
                            style="margin-bottom: var(--space-4)"
                        >
                            <button
                                onclick="setTaskPriority(0)"
                                id="priority-btn-0"
                                class="btn btn-ghost flex-1"
                                style="border-color: var(--brand-red); color: var(--brand-red)"
                            >
                                P0
                            </button>
                            <button
                                onclick="setTaskPriority(1)"
                                id="priority-btn-1"
                                class="btn btn-ghost flex-1"
                                style="border-color: var(--warning); color: var(--warning)"
                            >
                                P1
                            </button>
                            <button
                                onclick="setTaskPriority(2)"
                                id="priority-btn-2"
                                class="btn btn-ghost flex-1"
                                style="border-color: #3b82f6; color: #3b82f6"
                            >
                                P2
                            </button>
                        </div>
                        <div class="form-actions">
                            <button
                                onclick="closeAddTask()"
                                class="btn btn-ghost"
                            >
                                Cancel
                            </button>
                            <button
                                onclick="submitTask()"
                                class="btn btn-primary"
                            >
                                Add Task
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Task Action Modal -->
                <div id="task-action-modal" class="modal-overlay">
                    <div class="modal" style="max-width: 360px">
                        <div class="modal-header">
                            <div>
                                <h3 class="modal-title">Task Actions</h3>
                                <p
                                    id="action-modal-task-title"
                                    style="font-size: 13px; color: var(--text-muted); margin-top: var(--space-1); max-width: 250px"
                                    class="truncate"
                                >
                                </p>
                            </div>
                            <button
                                onclick="closeActionModal()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>

                        <div
                            class="space-y-2"
                            style="margin-bottom: var(--space-4)"
                        >
                            <button
                                id="action-move-todo"
                                onclick="modalMoveTask('todo')"
                                class="btn btn-ghost"
                                style="width: 100%; justify-content: flex-start"
                            >
                                <span class="status-dot idle"></span> Move to
                                To-Do
                            </button>
                            <button
                                id="action-move-progress"
                                onclick="modalMoveTask('progress')"
                                class="btn btn-ghost"
                                style="width: 100%; justify-content: flex-start"
                            >
                                <span class="status-dot warning"></span> Move to
                                In Progress
                            </button>
                            <button
                                id="action-move-done"
                                onclick="modalMoveTask('done')"
                                class="btn btn-ghost"
                                style="width: 100%; justify-content: flex-start"
                            >
                                <span class="status-dot success"></span> Move to
                                Done
                            </button>
                            <button
                                id="action-move-archive"
                                onclick="modalMoveTask('archive')"
                                class="btn btn-ghost"
                                style="width: 100%; justify-content: flex-start"
                            >
                                üì¶ Archive
                            </button>
                        </div>

                        <div
                            style="border-top: 1px solid var(--border-default); padding-top: var(--space-4)"
                            class="space-y-2"
                        >
                            <button
                                onclick="modalEditTitle()"
                                class="btn btn-ghost"
                                style="width: 100%; justify-content: flex-start"
                            >
                                ‚úèÔ∏è Edit Title
                            </button>
                            <button
                                onclick="modalCyclePriority()"
                                class="btn btn-ghost"
                                style="width: 100%; justify-content: flex-start"
                            >
                                üîÑ <span id="action-priority-text"
                                >Change Priority (P1)</span>
                            </button>
                        </div>

                        <div
                            style="border-top: 1px solid var(--border-default); padding-top: var(--space-4); margin-top: var(--space-4)"
                        >
                            <button
                                onclick="modalDeleteTask()"
                                class="btn btn-ghost"
                                style="width: 100%; justify-content: flex-start; color: var(--error)"
                            >
                                üóëÔ∏è Delete Task
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Edit Title Modal -->
                <div id="edit-title-modal" class="modal-overlay">
                    <div class="modal" style="max-width: 360px">
                        <div class="modal-header">
                            <h3 class="modal-title">Edit Task Title</h3>
                            <button
                                onclick="closeEditTitleModal()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>
                        <input
                            type="text"
                            id="edit-title-input"
                            class="input"
                            placeholder="Task title..."
                            style="margin-bottom: var(--space-4)"
                        >
                        <div class="form-actions">
                            <button
                                onclick="closeEditTitleModal()"
                                class="btn btn-ghost"
                            >
                                Cancel
                            </button>
                            <button
                                onclick="saveEditedTitle()"
                                class="btn btn-primary"
                            >
                                Save
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Confirm Delete Modal -->
                <div id="confirm-delete-modal" class="modal-overlay">
                    <div class="modal" style="max-width: 360px">
                        <div class="modal-header">
                            <h3 class="modal-title">Delete Task?</h3>
                            <button
                                onclick="closeDeleteModal()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>
                        <p
                            id="delete-modal-task-title"
                            style="font-size: 13px; color: var(--text-muted); margin-bottom: var(--space-4)"
                            class="truncate"
                        >
                        </p>
                        <div class="form-actions">
                            <button
                                onclick="closeDeleteModal()"
                                class="btn btn-ghost"
                            >
                                Cancel
                            </button>
                            <button
                                onclick="confirmDeleteTask()"
                                class="btn btn-danger"
                            >
                                Delete
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Task Detail Modal (Trello-like) -->
                <div id="task-detail-modal" class="modal-overlay">
                    <div
                        class="modal"
                        style="max-width: 600px; max-height: 85vh; display: flex; flex-direction: column"
                    >
                        <div
                            class="modal-header"
                            style="border-bottom: 1px solid var(--border-default)"
                        >
                            <div style="flex: 1">
                                <input
                                    type="text"
                                    id="task-detail-title"
                                    class="input"
                                    style="font-size: 18px; font-weight: 600; border: none; background: transparent; padding: 0; width: 100%"
                                    placeholder="Task title..."
                                >
                                <div
                                    style="display: flex; align-items: center; gap: var(--space-3); margin-top: var(--space-2)"
                                >
                                    <span id="task-detail-status" class="badge"
                                    >To-Do</span>
                                    <span
                                        id="task-detail-priority"
                                        class="badge badge-primary"
                                    >P1</span>
                                    <span
                                        id="task-detail-date"
                                        style="font-size: 12px; color: var(--text-muted)"
                                    ></span>
                                </div>
                            </div>
                            <button
                                onclick="closeTaskDetailModal()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>

                        <div
                            class="modal-body"
                            style="flex: 1; overflow-y: auto; padding: var(--space-4) var(--space-6)"
                        >
                            <!-- Description -->
                            <div style="margin-bottom: var(--space-5)">
                                <label
                                    style="font-size: 13px; font-weight: 600; color: var(--text-secondary); display: block; margin-bottom: var(--space-2)"
                                >
                                    üìù Description
                                </label>
                                <textarea
                                    id="task-detail-description"
                                    class="input"
                                    placeholder="Add a more detailed description..."
                                    style="min-height: 100px; resize: vertical; font-size: 14px; line-height: 1.6"
                                ></textarea>
                            </div>

                            <!-- Attachments -->
                            <div style="margin-bottom: var(--space-5)">
                                <label
                                    style="font-size: 13px; font-weight: 600; color: var(--text-secondary); display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2)"
                                >
                                    üìé Attachments
                                    <button
                                        onclick="document.getElementById('task-image-upload').click()"
                                        class="btn btn-ghost"
                                        style="font-size: 12px; padding: 4px 8px"
                                    >
                                        + Add Image
                                    </button>
                                </label>
                                <input
                                    type="file"
                                    id="task-image-upload"
                                    accept="image/*"
                                    class="hidden"
                                    onchange="handleTaskImageUpload(event)"
                                >
                                <div
                                    id="task-detail-images"
                                    style="display: flex; flex-wrap: wrap; gap: var(--space-3)"
                                >
                                    <!-- Images rendered here -->
                                    <div
                                        style="color: var(--text-muted); font-size: 13px"
                                    >
                                        No attachments yet
                                    </div>
                                </div>
                            </div>

                            <!-- Move/Priority Actions -->
                            <div
                                style="border-top: 1px solid var(--border-default); padding-top: var(--space-4)"
                            >
                                <label
                                    style="font-size: 13px; font-weight: 600; color: var(--text-secondary); display: block; margin-bottom: var(--space-2)"
                                >
                                    ‚ö° Actions
                                </label>
                                <div
                                    style="display: flex; flex-wrap: wrap; gap: var(--space-2)"
                                >
                                    <button
                                        onclick="taskDetailMove('todo')"
                                        class="btn btn-ghost"
                                        style="font-size: 12px"
                                    >
                                        <span class="status-dot idle"></span>
                                        To-Do
                                    </button>
                                    <button
                                        onclick="taskDetailMove('progress')"
                                        class="btn btn-ghost"
                                        style="font-size: 12px"
                                    >
                                        <span class="status-dot warning"></span>
                                        In Progress
                                    </button>
                                    <button
                                        onclick="taskDetailMove('done')"
                                        class="btn btn-ghost"
                                        style="font-size: 12px"
                                    >
                                        <span class="status-dot success"></span>
                                        Done
                                    </button>
                                    <button
                                        onclick="taskDetailCyclePriority()"
                                        class="btn btn-ghost"
                                        style="font-size: 12px"
                                    >
                                        üîÑ Priority
                                    </button>
                                    <button
                                        onclick="taskDetailDelete()"
                                        class="btn btn-ghost"
                                        style="font-size: 12px; color: var(--error)"
                                    >
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div
                            class="modal-footer"
                            style="border-top: 1px solid var(--border-default); padding: var(--space-4) var(--space-6); display: flex; justify-content: flex-end; gap: var(--space-3)"
                        >
                            <button
                                onclick="closeTaskDetailModal()"
                                class="btn btn-ghost"
                            >
                                Close
                            </button>
                            <button
                                onclick="saveTaskDetails()"
                                class="btn btn-primary"
                            >
                                üíæ Save Changes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Memory File Viewer Modal -->
                <div id="memory-file-modal" class="modal-overlay">
                    <div
                        class="modal modal-lg"
                        style="max-width: 1100px; height: 85vh; display: flex; flex-direction: column; padding: 0; overflow: hidden"
                    >
                        <div
                            class="modal-header"
                            style="flex-shrink: 0; padding: var(--space-4) var(--space-6); border-bottom: 1px solid var(--border-default)"
                        >
                            <h3 class="modal-title" id="memory-file-title">
                                Memory File
                            </h3>
                            <button
                                onclick="closeMemoryModal()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>
                        <div
                            class="modal-body"
                            style="flex: 1; display: flex; overflow: hidden; padding: 0; min-height: 0"
                        >
                            <!-- Editor panel -->
                            <div
                                style="flex: 1; display: flex; flex-direction: column; min-width: 0"
                            >
                                <textarea
                                    id="memory-file-content"
                                    style="flex: 1; width: 100%; min-height: 0; font-family: 'SF Mono', 'Monaco', 'Consolas', monospace; font-size: 13px; line-height: 1.6; padding: var(--space-4) var(--space-6); border: none; resize: none; background: var(--surface-2); color: var(--text-primary); outline: none"
                                    placeholder="Loading..."
                                ></textarea>
                            </div>
                            <!-- Version history sidebar -->
                            <div
                                class="version-history-panel"
                                style="width: 280px; flex-shrink: 0; border-left: 1px solid var(--border-default); background: var(--surface-1); display: flex; flex-direction: column"
                            >
                                <div
                                    style="padding: var(--space-3) var(--space-4); border-bottom: 1px solid var(--border-default); font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px"
                                >
                                    üìú Version History
                                </div>
                                <div
                                    id="version-history-list"
                                    style="flex: 1; overflow-y: auto; padding: var(--space-2)"
                                >
                                    <div
                                        style="color: var(--text-muted); font-size: 12px; padding: var(--space-3)"
                                    >
                                        No versions yet
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div
                            class="modal-footer"
                            style="flex-shrink: 0; padding: var(--space-4) var(--space-6); border-top: 1px solid var(--border-default); display: flex; justify-content: space-between"
                        >
                            <div
                                style="font-size: 12px; color: var(--text-muted)"
                            >
                                üí° Changes are saved with version history
                            </div>
                            <div style="display: flex; gap: var(--space-2)">
                                <button
                                    onclick="closeMemoryModal()"
                                    class="btn btn-ghost"
                                >
                                    Close
                                </button>
                                <button
                                    id="memory-save-btn"
                                    onclick="saveMemoryFile()"
                                    class="btn btn-primary"
                                >
                                    üíæ Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diff View Modal -->
                <!-- IDE-style Diff Viewer -->
                <div id="diff-modal" class="modal-overlay">
                    <div
                        class="modal"
                        style="max-width: 95vw; width: 1400px; height: 85vh; display: flex; flex-direction: column; padding: 0; overflow: hidden"
                    >
                        <div
                            class="modal-header"
                            style="flex-shrink: 0; padding: var(--space-3) var(--space-6); border-bottom: 1px solid var(--border-default); display: flex; align-items: center; justify-content: space-between"
                        >
                            <div
                                style="display: flex; align-items: center; gap: var(--space-4)"
                            >
                                <h3
                                    class="modal-title"
                                    id="diff-modal-title"
                                    style="margin: 0"
                                >
                                    Compare Versions
                                </h3>
                                <div
                                    id="diff-stats"
                                    style="font-size: 12px; color: var(--text-muted)"
                                >
                                </div>
                            </div>
                            <button
                                onclick="closeDiffModal()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>
                        <!-- Side-by-side diff panes -->
                        <div
                            style="flex: 1; display: flex; overflow: hidden; min-height: 0"
                        >
                            <!-- Current (left) -->
                            <div
                                style="flex: 1; display: flex; flex-direction: column; min-width: 0; border-right: 1px solid var(--border-default)"
                            >
                                <div
                                    style="padding: 6px 16px; background: var(--surface-1); border-bottom: 1px solid var(--border-default); font-weight: 600; font-size: 12px; color: var(--text-secondary)"
                                >
                                    üìÑ Current Version
                                </div>
                                <div id="diff-current" class="diff-pane"></div>
                            </div>
                            <!-- Historical (right) -->
                            <div
                                style="flex: 1; display: flex; flex-direction: column; min-width: 0"
                            >
                                <div
                                    style="padding: 6px 16px; background: var(--surface-1); border-bottom: 1px solid var(--border-default); font-weight: 600; font-size: 12px; color: var(--text-secondary)"
                                >
                                    üìú <span id="diff-version-date"
                                    >Historical Version</span>
                                </div>
                                <div id="diff-historical" class="diff-pane">
                                </div>
                            </div>
                        </div>
                        <div
                            class="modal-footer"
                            style="flex-shrink: 0; padding: var(--space-3) var(--space-6); border-top: 1px solid var(--border-default); display: flex; justify-content: space-between; align-items: center"
                        >
                            <div
                                style="display: flex; align-items: center; gap: 12px; font-size: 12px"
                            >
                                <span
                                    style="display: flex; align-items: center; gap: 4px"
                                ><span
                                        style="display: inline-block; width: 12px; height: 12px; background: rgba(46, 160, 67, 0.25); border-left: 3px solid #3fb950; border-radius: 2px"
                                    ></span> Added</span>
                                <span
                                    style="display: flex; align-items: center; gap: 4px"
                                ><span
                                        style="display: inline-block; width: 12px; height: 12px; background: rgba(248, 81, 73, 0.25); border-left: 3px solid #f85149; border-radius: 2px"
                                    ></span> Removed</span>
                                <span
                                    style="display: flex; align-items: center; gap: 4px"
                                ><span
                                        style="display: inline-block; width: 12px; height: 12px; background: rgba(210, 153, 34, 0.15); border-left: 3px solid #d29922; border-radius: 2px"
                                    ></span> Modified</span>
                            </div>
                            <div style="display: flex; gap: var(--space-2)">
                                <button
                                    onclick="closeDiffModal()"
                                    class="btn btn-ghost"
                                >
                                    Close
                                </button>
                                <button
                                    id="diff-restore-btn"
                                    onclick="restoreFromDiff()"
                                    class="btn btn-primary"
                                >
                                    ‚Ü©Ô∏è Restore This Version
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Modal -->
                <div id="settings-modal" class="modal-overlay">
                    <div class="modal modal-lg">
                        <div class="modal-header">
                            <h3 class="modal-title">‚öôÔ∏è Dashboard Settings</h3>
                            <button
                                onclick="closeSettingsModal()"
                                class="modal-close"
                            >
                                ‚úï
                            </button>
                        </div>

                        <!-- Theme Picker -->
                        <!-- Gateway Connection -->
                        <div class="modal-section">
                            <h4 class="modal-section-title">
                                üîå Gateway Connection
                            </h4>
                            <div class="modal-section-content">
                                <div
                                    class="flex items-center gap-2"
                                    style="margin-bottom: var(--space-3)"
                                >
                                    <span
                                        id="settings-gateway-dot"
                                        class="status-dot idle"
                                    ></span>
                                    <span
                                        id="settings-gateway-status"
                                        style="font-size: 13px; color: var(--text-muted)"
                                    >Disconnected</span>
                                </div>
                                <div class="form-group">
                                    <label class="form-label"
                                    >Gateway Host</label>
                                    <input
                                        type="text"
                                        id="gateway-host"
                                        class="input"
                                        placeholder="e.g., moltbot.local or 192.168.1.100"
                                    >
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Port</label>
                                        <input
                                            type="number"
                                            id="gateway-port"
                                            class="input"
                                            placeholder="443"
                                            value="443"
                                        >
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label"
                                        >Session Key</label>
                                        <input
                                            type="text"
                                            id="gateway-session"
                                            class="input"
                                            placeholder="main"
                                            value="main"
                                        >
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label"
                                    >Token (optional)</label>
                                    <input
                                        type="password"
                                        id="gateway-token"
                                        class="input"
                                        placeholder="Gateway auth token"
                                    >
                                </div>
                                <div
                                    class="form-actions"
                                    style="margin-top: var(--space-3)"
                                >
                                    <button
                                        id="gateway-connect-btn"
                                        onclick="connectToGateway()"
                                        class="btn btn-primary"
                                        style="background: var(--success)"
                                    >
                                        Connect
                                    </button>
                                    <button
                                        id="gateway-disconnect-btn"
                                        onclick="disconnectFromGateway()"
                                        class="btn btn-danger hidden"
                                    >
                                        Disconnect
                                    </button>
                                    <button
                                        onclick="requestGatewayRestart()"
                                        class="btn btn-ghost"
                                        title="Ask bot to restart gateway"
                                    >
                                        Restart
                                    </button>
                                </div>
                                <p
                                    style="font-size: 12px; color: var(--text-muted); margin-top: var(--space-2)"
                                >
                                    Connect to the same session as
                                    Telegram/Android for mirrored chat.
                                </p>
                            </div>
                        </div>

                        <!-- AI Provider & Model -->
                        <div class="modal-section">
                            <h4 class="modal-section-title">
                                ü§ñ AI Provider & Model
                            </h4>
                            <div class="modal-section-content">
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Current Provider
                                        </div>
                                        <div class="setting-desc">
                                            AI service currently in use
                                        </div>
                                    </div>
                                    <div
                                        id="current-provider-display"
                                        style="font-weight: 600; color: var(--text-primary)"
                                    >
                                        --
                                    </div>
                                </div>
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Current Model
                                        </div>
                                        <div class="setting-desc">
                                            Specific model in use
                                        </div>
                                    </div>
                                    <div
                                        id="current-model-display"
                                        style="font-weight: 600; color: var(--text-primary)"
                                    >
                                        --
                                    </div>
                                </div>
                                <div class="setting-row" style="flex-wrap: wrap; gap: 8px;">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Change Default Model
                                        </div>
                                        <div class="setting-desc">
                                            Change the global default for all
                                            agents
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                        <select id="setting-provider" class="select" style="min-width: 130px;"
                                                onchange="onSettingsProviderChange()">
                                            <!-- Populated dynamically -->
                                        </select>
                                        <select id="setting-model" class="select" style="min-width: 180px;">
                                            <!-- Populated dynamically -->
                                        </select>
                                        <button
                                            onclick="changeGlobalModel()"
                                            class="btn btn-primary"
                                            style="padding: 4px 12px; font-size: 12px"
                                            title="Apply as global default"
                                        >
                                            Apply
                                        </button>
                                    </div>
                                </div>
                                <p
                                    style="font-size: 12px; color: var(--text-muted); margin-top: var(--space-2)"
                                >
                                    ‚ö° Header dropdown changes the current
                                    session only<br>
                                    üåê This setting changes the global default
                                    (restarts gateway)
                                </p>
                            </div>
                        </div>

                        <!-- SoLoBot Behavior -->
                        <div class="modal-section">
                            <h4 class="modal-section-title">
                                ü§ñ SoLoBot Behavior
                            </h4>
                            <div class="modal-section-content">
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Task Pickup Frequency
                                        </div>
                                        <div class="setting-desc">
                                            How often SoLoBot checks for In
                                            Progress tasks
                                        </div>
                                    </div>
                                    <select
                                        id="setting-pickup-freq"
                                        onchange="updateSetting('pickupFreq', this.value)"
                                        class="select"
                                    >
                                        <option value="disabled">
                                            Disabled
                                        </option>
                                        <option value="60000">
                                            Every 1 min
                                        </option>
                                        <option value="300000">
                                            Every 5 min
                                        </option>
                                        <option value="1800000">
                                            Every 30 min
                                        </option>
                                    </select>
                                </div>
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Work Priority Order
                                        </div>
                                        <div class="setting-desc">
                                            How tasks are prioritized
                                        </div>
                                    </div>
                                    <select
                                        id="setting-priority-order"
                                        onchange="updateSetting('priorityOrder', this.value)"
                                        class="select"
                                    >
                                        <option value="priority">
                                            P0 ‚Üí P1 ‚Üí P2
                                        </option>
                                        <option value="fifo">
                                            First In, First Out
                                        </option>
                                        <option value="lifo">
                                            Last In, First Out
                                        </option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Dashboard Settings -->
                        <div class="modal-section">
                            <h4 class="modal-section-title">üìä Dashboard</h4>
                            <div class="modal-section-content">
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Auto-Refresh
                                        </div>
                                        <div class="setting-desc">
                                            How often dashboard reloads data
                                        </div>
                                    </div>
                                    <select
                                        id="setting-refresh"
                                        onchange="updateSetting('refreshInterval', this.value)"
                                        class="select"
                                    >
                                        <option value="5000">
                                            Every 5 sec
                                        </option>
                                        <option value="10000">
                                            Every 10 sec
                                        </option>
                                        <option value="30000">
                                            Every 30 sec
                                        </option>
                                        <option value="60000">
                                            Every 1 min
                                        </option>
                                        <option value="0">Disabled</option>
                                    </select>
                                </div>
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Default New Task Priority
                                        </div>
                                        <div class="setting-desc">
                                            Priority for new tasks
                                        </div>
                                    </div>
                                    <select
                                        id="setting-default-priority"
                                        onchange="updateSetting('defaultPriority', this.value)"
                                        class="select"
                                    >
                                        <option value="0">P0 (Urgent)</option>
                                        <option value="1">P1 (Normal)</option>
                                        <option value="2">P2 (Low)</option>
                                    </select>
                                </div>
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Compact Mode
                                        </div>
                                        <div class="setting-desc">
                                            Denser task cards
                                        </div>
                                    </div>
                                    <label class="toggle">
                                        <input
                                            type="checkbox"
                                            id="setting-compact"
                                            onchange="updateSetting('compactMode', this.checked)"
                                        >
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Visible Panels -->
                        <div class="modal-section">
                            <h4 class="modal-section-title">
                                üëÅÔ∏è Visible Panels
                            </h4>
                            <div class="modal-section-content">
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <span class="setting-title">üé® Theme</span>
                                        <div class="setting-desc">Dashboard color theme</div>
                                    </div>
                                    <div style="display: flex; gap: 4px; align-items: center;">
                                        <button onclick="scrollToThemePicker()" id="theme-current-label"
                                                class="btn btn-ghost" style="padding: 4px 10px; font-size: 12px; border: 1px solid var(--border);">
                                            üé® Choose Theme
                                        </button>
                                    </div>
                                </div>
                                <div class="setting-row">
                                    <span class="setting-title"
                                    >SoLoBot Live Panel</span>
                                    <input
                                        type="checkbox"
                                        id="setting-show-live"
                                        onchange="updateSetting('showLive', this.checked)"
                                        checked
                                        style="accent-color: var(--brand-red)"
                                    >
                                </div>
                                <div class="setting-row">
                                    <span class="setting-title"
                                    >Activity Log</span>
                                    <input
                                        type="checkbox"
                                        id="setting-show-activity"
                                        onchange="updateSetting('showActivity', this.checked)"
                                        checked
                                        style="accent-color: var(--brand-red)"
                                    >
                                </div>
                                <div class="setting-row">
                                    <span class="setting-title"
                                    >Notes Panel</span>
                                    <input
                                        type="checkbox"
                                        id="setting-show-notes"
                                        onchange="updateSetting('showNotes', this.checked)"
                                        checked
                                        style="accent-color: var(--brand-red)"
                                    >
                                </div>
                                <div class="setting-row">
                                    <span class="setting-title"
                                    >Product Status</span>
                                    <input
                                        type="checkbox"
                                        id="setting-show-products"
                                        onchange="updateSetting('showProducts', this.checked)"
                                        checked
                                        style="accent-color: var(--brand-red)"
                                    >
                                </div>
                                <div class="setting-row">
                                    <span class="setting-title">Docs Hub</span>
                                    <input
                                        type="checkbox"
                                        id="setting-show-docs"
                                        onchange="updateSetting('showDocs', this.checked)"
                                        checked
                                        style="accent-color: var(--brand-red)"
                                    >
                                </div>
                            </div>
                        </div>


                        <div class="modal-section" id="theme-picker-container">
                            <div class="theme-picker-section">
                                <div class="theme-picker-header">
                                    <h3 class="theme-picker-title">
                                        üé® Appearance
                                    </h3>
                                    <span class="theme-picker-subtitle"
                                    >Choose your preferred color theme</span>
                                </div>
                                <div class="theme-category">
                                    <div class="theme-category-title">
                                        Dark Themes
                                    </div>
                                    <div class="theme-grid">
                                        <div
                                            class="theme-card"
                                            data-theme="midnight"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #0c0d10"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #1c1e23"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #a9b2bc"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #bc2026"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #22c55e"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #14161a"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #fff; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #bc2026"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Midnight
                                                </div>
                                                <div class="theme-card-desc">
                                                    Deep slate grays
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="obsidian"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #000"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #141414"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #b8b8b8"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #fff"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #10b981"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #0a0a0a"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #fff; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #fff"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Obsidian
                                                </div>
                                                <div class="theme-card-desc">
                                                    Pure black elegance
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="nord"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #2e3440"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #4c566a"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #d8dee9"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #88c0d0"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #a3be8c"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #3b4252"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #eceff4; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #88c0d0"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Nord
                                                </div>
                                                <div class="theme-card-desc">
                                                    Nordic blue-gray
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="dracula"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #282a36"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #44475a"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #f8f8f2"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #ff79c6"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #50fa7b"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #282a36"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #f8f8f2; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #ff79c6"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Dracula
                                                </div>
                                                <div class="theme-card-desc">
                                                    Purple & pink
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="tokyo-night"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #1a1b26"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #24283b"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #c0caf5"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #7aa2f7"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #9ece6a"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #1a1b26"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #c0caf5; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #7aa2f7"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Tokyo Night
                                                </div>
                                                <div class="theme-card-desc">
                                                    Neon blue accents
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="monokai"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #272822"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #414339"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #f8f8f2"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #fd971f"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #a6e22e"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #272822"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #f8f8f2; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #fd971f"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Monokai
                                                </div>
                                                <div class="theme-card-desc">
                                                    Warm & vibrant
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="catppuccin-mocha"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #1e1e2e"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #45475a"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #cdd6f4"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #f5c2e7"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #a6e3a1"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #1e1e2e"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #cdd6f4; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #f5c2e7"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Catppuccin Mocha
                                                </div>
                                                <div class="theme-card-desc">
                                                    Soft pastels
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="theme-category">
                                    <div class="theme-category-title">
                                        Light Themes
                                    </div>
                                    <div class="theme-grid">
                                        <div
                                            class="theme-card"
                                            data-theme="snow"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #f8fafc"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #e2e8f0"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #1b2232"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #bc2026"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #16a34a"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #fff"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #1b2232; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #bc2026"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Snow
                                                </div>
                                                <div class="theme-card-desc">
                                                    Clean & minimal
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="latte"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #eff1f5"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #ccd0da"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #4c4f69"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #ea76cb"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #40a02b"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #e6e9ef"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #4c4f69; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #ea76cb"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Latte
                                                </div>
                                                <div class="theme-card-desc">
                                                    Warm cream tones
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="rose-pine-dawn"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #faf4ed"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #f2e9e1"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #575279"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #d65d92"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #56949f"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #fffaf3"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #575279; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #d65d92"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Rose Pine Dawn
                                                </div>
                                                <div class="theme-card-desc">
                                                    Soft pink warmth
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="solarized-light"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #fdf6e3"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #eee8d5"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #073642"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #268bd2"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #859900"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #eee8d5"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #073642; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #268bd2"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Solarized Light
                                                </div>
                                                <div class="theme-card-desc">
                                                    Classic warm
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="paper"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #fff"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #f5f5f5"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #212121"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #424242"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #2e7d32"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #fafafa"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #212121; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #424242"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Paper
                                                </div>
                                                <div class="theme-card-desc">
                                                    Ultra minimal
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="theme-category">
                                    <div class="theme-category-title">
                                        Special Themes
                                    </div>
                                    <div class="theme-grid">
                                        <div
                                            class="theme-card"
                                            data-theme="solovision-red"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #0f0506"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #2d1215"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #e5c6c9"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #bc2026"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #22c55e"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #1a0a0c"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #fff; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #bc2026"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    SoLoVision Red
                                                </div>
                                                <div class="theme-card-desc">
                                                    Brand essence
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="cyberpunk"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #0a0e27"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #1a1f4d"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #00ff9f"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #ff00ff"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #ffee00"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #0f1535"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #00ff9f; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #ff00ff"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Cyberpunk
                                                </div>
                                                <div class="theme-card-desc">
                                                    Neon future
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                        <div
                                            class="theme-card"
                                            data-theme="ocean"
                                        >
                                            <div class="theme-card-preview">
                                                <div
                                                    class="theme-preview-colors"
                                                >
                                                    <span
                                                        class="theme-color"
                                                        style="background: #0a1628"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #15293f"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #7dd3fc"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #06b6d4"
                                                    ></span><span
                                                        class="theme-color"
                                                        style="background: #10b981"
                                                    ></span>
                                                </div>
                                                <div
                                                    class="theme-preview-strip"
                                                >
                                                    <div
                                                        class="preview-surface"
                                                        style="background: #0e1e33"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-text"
                                                        style="background: #e0f2fe; opacity: 0.9"
                                                    >
                                                    </div>
                                                    <div
                                                        class="preview-accent"
                                                        style="background: #06b6d4"
                                                    >
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="theme-card-info">
                                                <div class="theme-card-name">
                                                    Ocean
                                                </div>
                                                <div class="theme-card-desc">
                                                    Deep teal waters
                                                </div>
                                            </div>
                                            <div class="theme-card-check">
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                >
                                                    <path
                                                        d="M13.5 4L6 11.5L2.5 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Danger Zone -->
                        <div class="modal-section">
                            <h4
                                class="modal-section-title"
                                style="color: var(--error)"
                            >
                                ‚ö†Ô∏è Danger Zone
                            </h4>
                            <div class="danger-zone">
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Reset Local Data
                                        </div>
                                        <div class="setting-desc">
                                            Reload all data from server
                                        </div>
                                    </div>
                                    <button
                                        onclick="resetToServerState()"
                                        class="btn btn-danger"
                                        style="padding: var(--space-2) var(--space-3)"
                                    >
                                        Reset
                                    </button>
                                </div>
                                <div class="setting-row">
                                    <div class="setting-info">
                                        <div class="setting-title">
                                            Clear All Data
                                        </div>
                                        <div class="setting-desc">
                                            Delete all local data and tasks
                                        </div>
                                    </div>
                                    <button
                                        onclick="clearAllData()"
                                        class="btn btn-danger"
                                        style="padding: var(--space-2) var(--space-3)"
                                    >
                                        Clear
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div
                            style="text-align: center; font-size: 12px; color: var(--text-muted); margin-top: var(--space-4); padding-top: var(--space-4); border-top: 1px solid var(--border-default)"
                        >
                            Dashboard v3.2.0 ‚Ä¢ Gateway WebSocket Chat
                        </div>
                    </div>
                </div>

                <!-- Archive Modal -->
                <div id="archive-modal" class="modal-overlay">
                    <div
                        class="modal modal-lg"
                        style="max-height: 80vh; display: flex; flex-direction: column"
                    >
                        <div class="modal-header">
                            <h3 class="modal-title flex items-center gap-2">
                                üì¶ Archived Tasks
                                <span
                                    id="archive-modal-count"
                                    class="badge badge-error"
                                >0</span>
                            </h3>
                            <div class="flex items-center gap-2">
                                <button
                                    onclick="clearArchive()"
                                    style="font-size: 12px; color: var(--error); background: none; border: none; cursor: pointer"
                                >
                                    Clear All
                                </button>
                                <button
                                    onclick="closeArchiveModal()"
                                    class="modal-close"
                                >
                                    ‚úï
                                </button>
                            </div>
                        </div>
                        <div
                            id="archive-tasks-list"
                            style="flex: 1; overflow-y: auto; min-height: 200px"
                            class="space-y-2"
                        >
                        </div>
                    </div>
                </div>
            </div>
            <!-- END app-content -->
        </div>
        <!-- END app-layout -->

        <!-- New Session Name Modal -->
        <div id="new-session-modal" class="modal-overlay">
            <div class="modal" style="max-width: 450px">
                <div class="modal-header">
                    <h3 class="modal-title">Enter session name:</h3>
                    <button
                        onclick="closeNewSessionModal(null)"
                        class="modal-close"
                    >
                        ‚úï
                    </button>
                </div>
                <div
                    class="modal-body"
                    style="padding: var(--space-4) var(--space-6)"
                >
                    <input
                        type="text"
                        id="new-session-name-input"
                        class="input"
                        style="width: 100%; font-size: 14px"
                        placeholder="Session name"
                    >
                </div>
                <div
                    class="modal-footer"
                    style="display: flex; justify-content: flex-end; gap: var(--space-3); padding: var(--space-4) var(--space-6); border-top: 1px solid var(--border-default)"
                >
                    <button
                        onclick="closeNewSessionModal(null)"
                        class="btn btn-ghost"
                    >
                        Cancel
                    </button>
                    <button
                        onclick="submitNewSessionModal()"
                        class="btn btn-primary"
                    >
                        OK
                    </button>
                </div>
            </div>
        </div>

        <!-- Custom Confirm Modal -->
        <div id="confirm-modal" class="modal-overlay">
            <div class="modal" style="max-width: 400px">
                <div class="modal-header">
                    <h3 class="modal-title" id="confirm-modal-title">
                        Confirm
                    </h3>
                    <button
                        onclick="closeConfirmModal(false)"
                        class="modal-close"
                    >
                        ‚úï
                    </button>
                </div>
                <div
                    class="modal-body"
                    style="padding: var(--space-4) var(--space-6)"
                >
                    <p
                        id="confirm-modal-message"
                        style="margin: 0; color: var(--text-primary); line-height: 1.5; white-space: pre-line"
                    >
                    </p>
                </div>
                <div
                    class="modal-footer"
                    style="display: flex; justify-content: flex-end; gap: var(--space-3); padding: var(--space-4) var(--space-6); border-top: 1px solid var(--border-default)"
                >
                    <button
                        onclick="closeConfirmModal(false)"
                        class="btn btn-ghost"
                    >
                        Cancel
                    </button>
                    <button
                        onclick="closeConfirmModal(true)"
                        class="btn btn-primary"
                        id="confirm-modal-ok"
                    >
                        OK
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications Container -->
        <!-- Keyboard Shortcuts Modal -->
        <div id="shortcuts-modal" class="modal-overlay">
            <div class="modal" style="max-width: 600px">
                <div class="modal-header">
                    <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                    <button
                        onclick="hideModal('shortcuts-modal')"
                        class="btn-icon"
                    >
                        ‚úï
                    </button>
                </div>
                <div class="modal-body">
                    <div class="shortcuts-grid">
                        <div class="shortcut-group">
                            <div class="shortcut-group-title">Navigation</div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Dashboard</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">G</span><span
                                        class="shortcut-key"
                                    >D</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Chat</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">G</span><span
                                        class="shortcut-key"
                                    >C</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Memory</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">G</span><span
                                        class="shortcut-key"
                                    >M</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Products</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">G</span><span
                                        class="shortcut-key"
                                    >P</span>
                                </div>
                            </div>
                        </div>
                        <div class="shortcut-group">
                            <div class="shortcut-group-title">Focus Timer</div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc"
                                >Start/Pause Timer</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">F</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Reset Timer</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">Shift</span><span
                                        class="shortcut-key"
                                    >F</span>
                                </div>
                            </div>
                        </div>
                        <div class="shortcut-group">
                            <div class="shortcut-group-title">Tasks</div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">New Task</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">N</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Sync Tasks</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">S</span>
                                </div>
                            </div>
                        </div>
                        <div class="shortcut-group">
                            <div class="shortcut-group-title">General</div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc"
                                >Show Shortcuts</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">?</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Toggle Theme</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">T</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc">Settings</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">Ctrl</span><span
                                        class="shortcut-key"
                                    >,</span>
                                </div>
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-desc"
                                >Focus Chat Input</span>
                                <div class="shortcut-keys">
                                    <span class="shortcut-key">/</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button
                        onclick="hideModal('shortcuts-modal')"
                        class="btn btn-ghost"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Shortcuts Hint (bottom right) -->
        <div class="shortcuts-hint" onclick="showModal('shortcuts-modal')">
            <span class="shortcut-key">?</span>
            <span>Shortcuts</span>
        </div>

        <div
            id="toast-container"
            style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column-reverse; gap: 10px"
        >
        </div>

        <script src="gateway-client.js?v=3.7.1"></script>
        <script src="docs-hub-memory-files.js?v=3.0.0"></script>
        <!-- Modular dashboard scripts (load order matters) -->
        <script src="js/state.js?v=4.0.0"></script>
        <script src="js/utils.js?v=4.0.0"></script>
        <script src="js/ui.js?v=4.0.0"></script>
        <script src="js/focus-timer.js?v=4.0.0"></script>
        <script src="js/quick-stats.js?v=4.0.0"></script>
        <script src="js/keyboard.js?v=4.0.0"></script>
        <script src="js/models.js?v=4.0.0"></script>
        <script src="js/sessions.js?v=4.0.0"></script>
        <script src="js/notifications.js?v=4.0.0"></script>
        <script src="js/chat.js?v=4.0.0"></script>
        <script src="js/system.js?v=4.0.0"></script>
        <script src="js/tasks.js?v=4.0.0"></script>
        <script src="js/ui-handlers.js?v=4.0.0"></script>
        <script src="js/memory.js?v=4.0.0"></script>
        <script src="js/health.js?v=4.0.0"></script>
        <!-- Main init (must be last) -->
        <script src="dashboard.js?v=4.0.0"></script>
        <script>
            // Valid page names
            const VALID_PAGES = [
                "dashboard",
                "memory",
                "chat",
                "system",
                "products",
            ];

            // Get page from URL path
            function getPageFromURL() {
                const path = window.location.pathname.replace(
                    /^\/+|\/+$/g,
                    "",
                ); // trim slashes
                if (path && VALID_PAGES.includes(path)) {
                    return path;
                }
                return "dashboard"; // default
            }

            // Sidebar pin toggle
            function toggleSidebarPin() {
                const sidebar = document.getElementById(
                    "sidebar",
                );
                const icon = document.getElementById(
                    "sidebar-pin-icon",
                );
                const isPinned = sidebar.classList.toggle(
                    "pinned",
                );
                localStorage.setItem("sidebarPinned", isPinned);
                icon.textContent = isPinned ? "üîí" : "üîì";
                console.log("Sidebar pinned:", isPinned);
            }

            // Restore sidebar state on load
            if (
                localStorage.getItem("sidebarPinned") === "true"
            ) {
                document.getElementById("sidebar").classList
                    .add("pinned");
                document.getElementById("sidebar-pin-icon")
                    .textContent = "üîí";
            }

            // Page navigation with URL update
            function showPage(pageName, updateURL = true) {
                // Validate page name
                if (!VALID_PAGES.includes(pageName)) {
                    pageName = "dashboard";
                }

                // Save chat scroll position before leaving chat page
                const currentActivePage = document
                    .querySelector(".page.active");
                if (
                    currentActivePage &&
                    currentActivePage.id === "page-chat"
                ) {
                    if (
                        typeof saveChatScrollPosition ===
                            "function"
                    ) {
                        saveChatScrollPosition();
                    }
                }

                // Hide all pages
                document.querySelectorAll(".page").forEach(
                    (page) => {
                        page.classList.remove("active");
                    },
                );

                // Show selected page
                const targetPage = document.getElementById(
                    "page-" + pageName,
                );
                if (targetPage) {
                    targetPage.classList.add("active");
                }

                // Update sidebar active state
                document.querySelectorAll(".sidebar-item")
                    .forEach((item) => {
                        item.classList.remove("active");
                        if (item.dataset.page === pageName) {
                            item.classList.add("active");
                        }
                    });

                // Update URL without reload
                if (updateURL) {
                    const newPath = pageName === "dashboard"
                        ? "/"
                        : "/" + pageName;
                    if (window.location.pathname !== newPath) {
                        history.pushState(
                            { page: pageName },
                            "",
                            newPath,
                        );
                    }
                }

                // If showing memory page, load files
                if (pageName === "memory") {
                    renderMemoryFilesForPage();
                }

                // If showing chat page, restore scroll position
                if (pageName === "chat") {
                    setTimeout(() => {
                        if (
                            typeof restoreChatScrollPosition ===
                                "function"
                        ) {
                            restoreChatScrollPosition();
                        }
                    }, 50); // Small delay to ensure DOM is ready
                }

                // If showing chat page, render chat
                if (
                    pageName === "chat" &&
                    typeof renderChatPage === "function"
                ) {
                    renderChatPage();
                }

                // If showing system page, render system messages
                if (
                    pageName === "system" &&
                    typeof renderSystemPage === "function"
                ) {
                    renderSystemPage();
                }
            }

            // Handle browser back/forward buttons
            window.addEventListener("popstate", (event) => {
                const pageName = event.state?.page ||
                    getPageFromURL();
                showPage(pageName, false); // Don't update URL on popstate
            });

            // Initialize page from URL on load
            document.addEventListener(
                "DOMContentLoaded",
                () => {
                    const initialPage = getPageFromURL();
                    showPage(initialPage, false); // Don't push state on initial load
                },
            );

            // Render memory files for the Memory page
            async function renderMemoryFilesForPage(
                filter = "",
            ) {
                const container = document.getElementById(
                    "memory-files-grid",
                );
                if (!container) return;

                container.innerHTML =
                    '<div class="loading-state">Loading memory files...</div>';

                // Use the existing fetch function
                const files = await fetchMemoryFiles();

                if (files.length === 0) {
                    container.innerHTML =
                        '<div class="empty-state"><p>‚ö†Ô∏è No memory files found</p></div>';
                    return;
                }

                // Filter files
                const filtered = files.filter((file) =>
                    file.name.toLowerCase().includes(
                        filter.toLowerCase(),
                    ) ||
                    (file.description &&
                        file.description.toLowerCase().includes(
                            filter.toLowerCase(),
                        )) ||
                    (file.category &&
                        file.category.toLowerCase().includes(
                            filter.toLowerCase(),
                        ))
                );

                // Group by category
                const grouped = filtered.reduce(
                    (groups, file) => {
                        const category = file.category ||
                            "Other";
                        if (!groups[category]) {groups[
                                category
                            ] = [];}
                        groups[category].push(file);
                        return groups;
                    },
                    {},
                );

                // Sort categories
                const categoryOrder = [
                    "üß† Core Identity",
                    "üìñ Guides & Reference",
                    "üìã Planning & PRDs",
                    "‚öôÔ∏è System & Operations",
                    "üíº Business",
                    "üíª Code & Technical",
                    "üìÖ Daily Logs",
                    "üìÅ Other",
                ];
                const sortedCategories = Object.keys(grouped)
                    .sort((a, b) => {
                        const ai = categoryOrder.indexOf(a),
                            bi = categoryOrder.indexOf(b);
                        return (ai === -1 ? 99 : ai) -
                            (bi === -1 ? 99 : bi);
                    });

                const collapsedCats = JSON.parse(
                    localStorage.getItem(
                        "solobot-memory-collapsed",
                    ) || "{}",
                );

                // Render
                let html = "";
                sortedCategories.forEach((category) => {
                    const count = grouped[category].length;
                    const isCollapsed =
                        collapsedCats[category] === true;
                    html +=
                        `<div class="docs-category" data-category="${category}">`;
                    html +=
                        `<h3 class="category-title category-collapsible${
                            isCollapsed ? " collapsed" : ""
                        }" 
                             onclick="toggleMemoryCategory(this)">
                            <span class="category-chevron">${
                            isCollapsed ? "‚ñ∂" : "‚ñº"
                        }</span>
                            ${category} 
                            <span class="category-count">${count}</span>
                         </h3>`;
                    html +=
                        `<div class="docs-category-grid" style="${
                            isCollapsed ? "display:none;" : ""
                        }">`;

                    const sortedFiles = grouped[category].sort(
                        (a, b) => {
                            if (category === "Daily Logs") {
                                return b.name.localeCompare(
                                    a.name,
                                );
                            }
                            return a.name.localeCompare(b.name);
                        },
                    );

                    sortedFiles.forEach((file) => {
                        const modifiedDate = file.modified
                            ? new Date(file.modified)
                                .toLocaleDateString()
                            : "";
                        const botBadge =
                            file.botUpdated &&
                                !file.acknowledged
                                ? `<span class="badge badge-warning bot-updated-badge" title="Updated by SoLoBot">ü§ñ Updated</span>`
                                : file.acknowledged
                                ? `<span class="badge badge-success">‚úì Read</span>`
                                : "";
                        const botUpdatedClass =
                            file.botUpdated &&
                                !file.acknowledged
                                ? "bot-updated"
                                : "";
                        html += `
                        <div class="doc-card memory-file ${botUpdatedClass}" onclick="viewMemoryFile('${
                            file.path || file.name
                        }')" data-filepath="${
                            file.path || file.name
                        }">
                            <div style="display: flex; align-items: center; gap: var(--space-3);">
                                <div class="doc-icon icon-md">üìÑ</div>
                                <div style="min-width: 0; flex: 1;">
                                    <div class="doc-title" style="display: flex; align-items: center; gap: var(--space-2);">
                                        ${file.name}
                                        ${botBadge}
                                    </div>
                                    <div class="doc-description">${
                            file.description || ""
                        }</div>
                                    ${
                            modifiedDate
                                ? `<div class="doc-meta">Modified: ${modifiedDate}</div>`
                                : ""
                        }
                                </div>
                            </div>
                        </div>
                    `;
                    });

                    html += `</div></div>`;
                });

                container.innerHTML = html ||
                    '<div class="empty-state">No files match your search</div>';

                // Append sub-agent file sections
                if (typeof renderAgentSection === "function") {
                    renderAgentSection(container);
                }
            }

            // Sync memory files now (manual trigger)
            function syncMemoryFilesNow() {
                const statusEl = document.getElementById(
                    "sync-status",
                );
                if (statusEl) {
                    statusEl.className = "sync-status syncing";
                    statusEl.innerHTML =
                        '<span class="status-dot warning"></span> Syncing...';
                }

                // Clear cache and reload
                if (typeof memoryFilesCache !== "undefined") {
                    memoryFilesCache = [];
                    lastFetchTime = 0;
                }

                renderMemoryFilesForPage(
                    document.getElementById("memory-search")
                        ?.value || "",
                ).then(() => {
                    if (statusEl) {
                        statusEl.className =
                            "sync-status synced";
                        const now = new Date()
                            .toLocaleTimeString();
                        statusEl.innerHTML =
                            `<span class="status-dot success"></span> Last synced: ${now}`;
                    }
                });
            }

            // Theme toggle
            // Toggle theme (keyboard shortcut T) ‚Äî opens settings to theme picker
            function toggleTheme() {
                openSettingsModal();
                scrollToThemePicker();
            }

            // Scroll the settings modal to the theme picker section
            function scrollToThemePicker() {
                setTimeout(() => {
                    const container = document.getElementById(
                        "theme-picker-container",
                    );
                    if (container) {
                        container.scrollIntoView({
                            behavior: "smooth",
                            block: "start",
                        });
                    }
                }, 100);
            }

            // Legacy stub ‚Äî no longer needed but called by some init code
            function updateThemeIcon() {}

            // Load saved theme ‚Äî migrate old 'theme' key to new 'solobot-theme'
            // Also handle stale "dark"/"light" values from before theme system
            const THEME_MIGRATION = {
                "dark": "midnight",
                "light": "snow",
            };
            const legacyTheme = localStorage.getItem("theme");
            let savedTheme = localStorage.getItem(
                "solobot-theme",
            );

            // Migrate from old key
            if (!savedTheme && legacyTheme) {
                savedTheme = THEME_MIGRATION[legacyTheme] ||
                    "midnight";
                localStorage.setItem(
                    "solobot-theme",
                    savedTheme,
                );
                localStorage.removeItem("theme");
            }

            // Fix any stale "dark"/"light" values in the new key too
            if (savedTheme && THEME_MIGRATION[savedTheme]) {
                savedTheme = THEME_MIGRATION[savedTheme];
                localStorage.setItem(
                    "solobot-theme",
                    savedTheme,
                );
            }

            savedTheme = savedTheme || "midnight";
            document.documentElement.setAttribute(
                "data-theme",
                savedTheme,
            );
            updateThemeIcon(savedTheme);

            // Theme picker is inlined ‚Äî cards init via ThemePicker constructor at end of body

            // Scroll containment ‚Äî capture scroll only in panels that truly overflow
            // NOTE: .drop-zone removed ‚Äî kanban columns should not block page/widget scroll
            const scrollableSelectors =
                ".chat-messages, .activity-list, .notes-list, .terminal-output, .bento-widget-content";

            document.addEventListener("wheel", (e) => {
                const el = document.elementFromPoint(
                    e.clientX,
                    e.clientY,
                );
                const scrollable = el?.closest(
                    scrollableSelectors,
                );

                if (scrollable) {
                    const hasOverflow =
                        scrollable.scrollHeight >
                            scrollable.clientHeight + 2;
                    if (!hasOverflow) return; // No overflow ‚Äî let page scroll

                    const atTop = scrollable.scrollTop <= 0;
                    const atBottom =
                        scrollable.scrollTop +
                                scrollable.clientHeight >=
                            scrollable.scrollHeight - 2;
                    const scrollingUp = e.deltaY < 0;
                    const scrollingDown = e.deltaY > 0;

                    // At boundary ‚Äî let parent/page scroll
                    if (
                        (atTop && scrollingUp) ||
                        (atBottom && scrollingDown)
                    ) return;

                    e.preventDefault();
                    scrollable.scrollTop += e.deltaY;
                }
            }, { passive: false });

            window.setupScrollContainment = () => {}; // No-op now, handled globally

            // Modal helpers for the new class system
            function showModal(id) {
                document.getElementById(id).classList.add(
                    "visible",
                );
            }
            function hideModal(id) {
                document.getElementById(id).classList.remove(
                    "visible",
                );
            }

            // Click outside to close modals
            document.addEventListener("click", function (e) {
                if (
                    e.target.classList.contains(
                        "modal-overlay",
                    ) && e.target.classList.contains("visible")
                ) {
                    e.target.classList.remove("visible");
                }
            });

            // Override modal functions for new system
            const originalOpenSettingsModal =
                window.openSettingsModal;
            window.openSettingsModal = function () {
                showModal("settings-modal");
                if (
                    typeof originalOpenSettingsModal ===
                        "function"
                ) {
                    // Call original to load settings
                }
            };
            window.closeSettingsModal = function () {
                hideModal("settings-modal");
            };

            window.openAddTask = function (column) {
                window.addTaskColumn = column;
                showModal("add-task-modal");
                document.getElementById("new-task-title")
                    .focus();
            };
            window.closeAddTask = function () {
                hideModal("add-task-modal");
            };

            window.openArchiveModal = function () {
                showModal("archive-modal");
                renderArchive();
            };
            window.closeArchiveModal = function () {
                hideModal("archive-modal");
            };

            window.closeActionModal = function () {
                hideModal("task-action-modal");
            };
            window.closeEditTitleModal = function () {
                hideModal("edit-title-modal");
            };
            window.closeDeleteModal = function () {
                hideModal("confirm-delete-modal");
            };

            // Image preview visibility
            function showImagePreview(src) {
                const container = document.getElementById(
                    "image-preview-container",
                );
                const img = document.getElementById(
                    "image-preview",
                );
                img.src = src;
                container.classList.add("visible");
            }
            function clearImagePreview() {
                const container = document.getElementById(
                    "image-preview-container",
                );
                container.classList.remove("visible");
                pendingImage = null;
                document.getElementById("image-upload").value =
                    "";
            }

            // =================== TASK DETAIL MODAL ===================
            let currentDetailTask = null;
            let currentDetailColumn = null;

            window.openTaskDetail = function (taskId, column) {
                // Don't open detail if user is selecting text
                const sel = window.getSelection();
                if (sel && sel.toString().trim().length > 0) return;

                const task = state.tasks[column]?.find((t) =>
                    t.id === taskId
                );
                if (!task) return;

                currentDetailTask = task;
                currentDetailColumn = column;
                taskModalOpen = true; // Pause auto-refresh while editing

                // Populate modal
                document.getElementById("task-detail-title")
                    .value = task.title || "";
                document.getElementById(
                    "task-detail-description",
                ).value = task.description || "";

                // Status badge
                const statusEl = document.getElementById(
                    "task-detail-status",
                );
                const statusMap = {
                    todo: "To-Do",
                    progress: "In Progress",
                    done: "Done",
                    archive: "Archived",
                };
                statusEl.textContent = statusMap[column] ||
                    column;
                statusEl.className = "badge " +
                    (column === "done"
                        ? "badge-success"
                        : column === "progress"
                        ? "badge-warning"
                        : "");

                // Priority badge
                const priorityEl = document.getElementById(
                    "task-detail-priority",
                );
                priorityEl.textContent = "P" +
                    (task.priority || 1);
                priorityEl.className = "badge badge-primary";

                // Date
                const dateEl = document.getElementById(
                    "task-detail-date",
                );
                dateEl.textContent = task.createdAt
                    ? new Date(task.createdAt)
                        .toLocaleDateString()
                    : "";

                // Render images
                renderTaskImages();

                showModal("task-detail-modal");
            };

            window.closeTaskDetailModal = async function () {
                // Auto-save changes before closing
                if (currentDetailTask && currentDetailColumn) {
                    currentDetailTask.title =
                        document.getElementById(
                            "task-detail-title",
                        ).value;
                    currentDetailTask.description =
                        document.getElementById(
                            "task-detail-description",
                        ).value;
                    await saveState("Updated task");
                    render();
                }
                hideModal("task-detail-modal");
                currentDetailTask = null;
                currentDetailColumn = null;
                taskModalOpen = false; // Resume auto-refresh
            };

            function renderTaskImages() {
                const container = document.getElementById(
                    "task-detail-images",
                );
                const images = currentDetailTask?.images || [];

                if (images.length === 0) {
                    container.innerHTML =
                        '<div style="color: var(--text-muted); font-size: 13px;">No attachments yet</div>';
                    return;
                }

                container.innerHTML = images.map((img, idx) => `
                <div style="position: relative; width: 120px; height: 90px; border-radius: var(--radius-md); overflow: hidden; border: 1px solid var(--border-default);">
                    <img src="${img}" style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;" 
                         onclick="window.open('${img}', '_blank')">
                    <button onclick="removeTaskImage(${idx})" 
                            style="position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px;">
                        ‚úï
                    </button>
                </div>
            `).join("");
            }

            window.handleTaskImageUpload = function (event) {
                const file = event.target.files[0];
                if (!file) return;
                addImageToTask(file);
                event.target.value = ""; // Reset input
            };

            // Shared function to add image to current task
            function addImageToTask(file) {
                if (!file || !file.type.startsWith("image/")) {
                    return;
                }
                if (!currentDetailTask) return;

                const reader = new FileReader();
                reader.onload = function (e) {
                    if (!currentDetailTask.images) {
                        currentDetailTask.images = [];
                    }
                    currentDetailTask.images.push(
                        e.target.result,
                    );
                    renderTaskImages();
                    saveState("Added image to task");
                    showToast("Image added!", "success");
                };
                reader.readAsDataURL(file);
            }

            // Drag and drop support for task detail modal
            document.addEventListener(
                "DOMContentLoaded",
                function () {
                    const modal = document.getElementById(
                        "task-detail-modal",
                    );
                    if (!modal) return;

                    // Prevent default drag behaviors on the modal
                    [
                        "dragenter",
                        "dragover",
                        "dragleave",
                        "drop",
                    ].forEach((eventName) => {
                        modal.addEventListener(
                            eventName,
                            preventDefaults,
                            false,
                        );
                    });

                    function preventDefaults(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }

                    // Highlight drop zone
                    ["dragenter", "dragover"].forEach(
                        (eventName) => {
                            modal.addEventListener(
                                eventName,
                                () => {
                                    if (currentDetailTask) {
                                        modal.querySelector(
                                            ".modal",
                                        ).style.boxShadow =
                                            "0 0 0 3px var(--brand-red)";
                                    }
                                },
                                false,
                            );
                        },
                    );

                    ["dragleave", "drop"].forEach(
                        (eventName) => {
                            modal.addEventListener(
                                eventName,
                                () => {
                                    modal.querySelector(
                                        ".modal",
                                    ).style.boxShadow = "";
                                },
                                false,
                            );
                        },
                    );

                    // Handle drop
                    modal.addEventListener(
                        "drop",
                        function (e) {
                            if (!currentDetailTask) return;
                            const files = e.dataTransfer.files;
                            if (files.length > 0) {
                                [...files].forEach((file) => {
                                    if (
                                        file.type.startsWith(
                                            "image/",
                                        )
                                    ) {
                                        addImageToTask(file);
                                    }
                                });
                            }
                        },
                        false,
                    );

                    // Paste support for description field
                    const descField = document.getElementById(
                        "task-detail-description",
                    );
                    if (descField) {
                        descField.addEventListener(
                            "paste",
                            handleTaskPaste,
                        );
                    }
                },
            );

            // Handle paste event (Ctrl+V or right-click paste)
            function handleTaskPaste(e) {
                if (!currentDetailTask) return;

                const items = e.clipboardData?.items;
                if (!items) return;

                for (const item of items) {
                    if (item.type.startsWith("image/")) {
                        e.preventDefault();
                        const file = item.getAsFile();
                        if (file) addImageToTask(file);
                        return;
                    }
                }
            }

            window.removeTaskImage = function (index) {
                if (currentDetailTask?.images) {
                    currentDetailTask.images.splice(index, 1);
                    renderTaskImages();
                    saveState("Removed image from task");
                }
            };

            window.saveTaskDetails = function () {
                if (
                    !currentDetailTask || !currentDetailColumn
                ) return;

                currentDetailTask.title =
                    document.getElementById("task-detail-title")
                        .value;
                currentDetailTask.description =
                    document.getElementById(
                        "task-detail-description",
                    ).value;

                saveState("Updated task details");
                render();
                showToast("Task saved!", "success");
            };

            window.taskDetailMove = function (newColumn) {
                if (
                    !currentDetailTask ||
                    !currentDetailColumn ||
                    currentDetailColumn === newColumn
                ) return;

                // Save current details first
                currentDetailTask.title =
                    document.getElementById("task-detail-title")
                        .value;
                currentDetailTask.description =
                    document.getElementById(
                        "task-detail-description",
                    ).value;

                // Remove from current column
                const idx = state.tasks[currentDetailColumn]
                    .findIndex((t) =>
                        t.id === currentDetailTask.id
                    );
                if (idx > -1) {
                    state.tasks[currentDetailColumn].splice(
                        idx,
                        1,
                    );
                }

                // Add to new column
                if (newColumn === "done") {
                    currentDetailTask.completedAt = Date.now();
                }
                state.tasks[newColumn].unshift(
                    currentDetailTask,
                );

                currentDetailColumn = newColumn;

                // Update status badge
                const statusEl = document.getElementById(
                    "task-detail-status",
                );
                const statusMap = {
                    todo: "To-Do",
                    progress: "In Progress",
                    done: "Done",
                    archive: "Archived",
                };
                statusEl.textContent = statusMap[newColumn] ||
                    newColumn;
                statusEl.className = "badge " +
                    (newColumn === "done"
                        ? "badge-success"
                        : newColumn === "progress"
                        ? "badge-warning"
                        : "");

                saveState("Moved task to " + newColumn);
                render();
                showToast("Task moved!", "success");
            };

            window.taskDetailCyclePriority = function () {
                if (!currentDetailTask) return;
                currentDetailTask.priority =
                    (currentDetailTask.priority || 1) % 4 + 1;
                document.getElementById("task-detail-priority")
                    .textContent = "P" +
                        currentDetailTask.priority;
                saveState("Changed priority");
                render();
            };

            window.taskDetailDelete = async function () {
                if (
                    !currentDetailTask || !currentDetailColumn
                ) return;

                const confirmed = await showConfirm(
                    "Delete this task permanently?",
                    "Delete Task",
                    "Delete",
                );
                if (!confirmed) return;

                const idx = state.tasks[currentDetailColumn]
                    .findIndex((t) =>
                        t.id === currentDetailTask.id
                    );
                if (idx > -1) {
                    state.tasks[currentDetailColumn].splice(
                        idx,
                        1,
                    );
                }

                saveState("Deleted task");
                render();
                closeTaskDetailModal();
                showToast("Task deleted", "success");
            };
        </script>

        <!-- Memory Files Styles -->
        <link rel="stylesheet" href="css/docs.css?v=4.0.0">
        <script>
            // ===== THEME PICKER ENGINE =====
            class ThemePicker {
                constructor() {
                    const M = {
                        dark: "midnight",
                        light: "snow",
                    };
                    let s = localStorage.getItem(
                        "solobot-theme",
                    );
                    if (s && M[s]) {
                        s = M[s];
                        localStorage.setItem(
                            "solobot-theme",
                            s,
                        );
                    }
                    this.currentTheme = s || "midnight";
                    this.applyTheme(this.currentTheme, false);
                    this.setupThemeCards();
                    this.observeThemeChanges();
                }
                setupThemeCards() {
                    document.querySelectorAll(".theme-card")
                        .forEach((card) => {
                            const t = card.getAttribute(
                                "data-theme",
                            );
                            if (!t) return;
                            card.classList.toggle(
                                "active",
                                t === this.currentTheme,
                            );
                            card.onclick = () =>
                                this.selectTheme(t);
                        });
                }
                selectTheme(t) {
                    if (t === this.currentTheme) return;
                    this.currentTheme = t;
                    this.applyTheme(t, true);
                    localStorage.setItem("solobot-theme", t);
                    this.updateActiveCard();
                    window.dispatchEvent(
                        new CustomEvent("themeChanged", {
                            detail: { theme: t },
                        }),
                    );
                }
                applyTheme(t, animated) {
                    if (animated) {
                        document.body.classList.add(
                            "theme-transitioning",
                        );
                        setTimeout(
                            () =>
                                document.body.classList.remove(
                                    "theme-transitioning",
                                ),
                            350,
                        );
                    }
                    document.documentElement.setAttribute(
                        "data-theme",
                        t,
                    );
                }
                updateActiveCard() {
                    document.querySelectorAll(".theme-card")
                        .forEach((c) => {
                            c.classList.toggle(
                                "active",
                                c.getAttribute("data-theme") ===
                                    this.currentTheme,
                            );
                        });
                }
                observeThemeChanges() {
                    new MutationObserver((muts) => {
                        muts.forEach((m) => {
                            if (
                                m.attributeName === "data-theme"
                            ) {
                                const nt = document
                                    .documentElement
                                    .getAttribute("data-theme");
                                if (
                                    nt &&
                                    nt !== this.currentTheme
                                ) {
                                    this.currentTheme = nt;
                                    this.updateActiveCard();
                                }
                            }
                        });
                    }).observe(document.documentElement, {
                        attributes: true,
                        attributeFilter: ["data-theme"],
                    });
                }
                setTheme(t) {
                    this.selectTheme(t);
                }
                getTheme() {
                    return this.currentTheme;
                }
            }
            window.themePicker = new ThemePicker();
        </script>
    </body>
</html>
